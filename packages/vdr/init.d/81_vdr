#!/bin/sh
#
# configure and launch VDR
#
# runlevels: geexbox, debug

if [ ! -f /var/dvbcard ]; then
  echo "No DVB card found, not starting VDR"
  exit 0
fi

echo "### Starting VDR ###"

PLUGINS=""
for file in /etc/vdr/plugins.d/*; do
  # plugins are enabled by default
  PLUGIN=""
  ENABLED=yes
  . $file
  [ "$ENABLED" = yes ] && PLUGINS="$PLUGINS -P$PLUGIN"
  [ "$PLUGIN" = osdteletext ] && [ "$ENABLED" = yes ] && mkdir -p /tmp/vtx
done

# create /video if missing
for dir in /mnt/disk*; do
  [ -d "/mnt/$dir/video" ] && ln -sf "/mnt/$dir/video/" /video
done
mkdir -p /video

# start VDR
runvdr "$PLUGINS" &

exit 0
