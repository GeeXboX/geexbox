#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build zlib
$SCRIPTS/build Python

HOST_PYTHON="`ls -d $ROOT/$BUILD/Python*/objdir/buildpython`/python"
PYTHON_DIR=`ls -d $ROOT/$BUILD/Python*`

export CFLAGS="$CFLAGS -I$PYTHON_DIR/Include -I$PYTHON_DIR/objdir"
export LDSHARED="$CC -shared"
export SYSROOT_PREFIX
export PYTHON_INCLUDES="$PYTHON_DIR/Include"
export PYTHON_SITE_PACKAGES="`ls -d $LIB_PREFIX/lib/python*/site-packages`"/libxml2

cd $BUILD/$1*
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=$LIB_PREFIX \
            --enable-shared \
            --disable-static \
            --enable-ipv6=no \
            --with-python=$HOST_PYTHON \
            --with-zlib
make
make install

rm -rf python/tests
echo "from libxml2 import *" > python/__init__.py
$HOST_PYTHON -Wi -t $PYTHON_DIR/Lib/compileall.py python
