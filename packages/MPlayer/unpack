#!/bin/sh

. config/options

$SCRIPTS/build toolchain

apply_patch () {
  cat $PACKAGES/$1/patches.misc/$2 | patch -d \
      `echo $BUILD/$1* | cut -f1 -d\ ` -p1
}

sed -i 's/\(cc_check -lpthread\) && $TMPO/\1/' $BUILD/$1*/configure

if [ "$CONSOLE" = yes ]; then
  echo "## Applying CONSOLE mode only patches"
  for i in 250_bgvideo.diff 655_tvkeepon.diff; do
    apply_patch $1 $i
  done
fi

[ "$LCD4LINUX" = yes ] && apply_patch $1 575_streaminfo-dump.diff

exit 0
