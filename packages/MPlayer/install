#!/bin/sh

. config/options

$SCRIPTS/install ffmpeg
$SCRIPTS/install libbluray
$SCRIPTS/install freetype $2
[ "$UNRAR" = yes ] && $SCRIPTS/install unrar $2

mkdir -p $INSTALL/etc/mplayer
mkdir -p $INSTALL/usr/bin

cp $BUILD/$1*/mplayer $INSTALL/usr/bin
cp $PACKAGES/$1/config/mplayer.enna $INSTALL/etc/mplayer/mplayer.conf
cp $PACKAGES/$1/config/input.conf $INSTALL/etc/mplayer
cp $PACKAGES/$1/scripts/mp_set_option $INSTALL/usr/bin

[ "$TARGET_PLATFORM" = easygate ] && sed -i 's%mixer-channel=.*%mixer-channel=PCM%' $INSTALL/etc/mplayer/mplayer.conf

cat <<EOF > $INSTALL/etc/mplayer/no_unstable_vidix
You can enable nvidia/sis vidix driver simply by removing this file.
Vidix should give you better performance especially with low-end hardware.
This feature is not very well tested. That's why it is not enabled by
default. And that's also why you should help us, testing this feature
and reporting your results if you own nvidia/sis hardware.
EOF

mkdir -p $INSTALL/codecs

cp $BUILD/$1*/etc/codecs.conf $INSTALL/etc/mplayer

cat >> $INSTALL/etc/video <<EOF
# Support for Multi-threaded video decoding
MT_DECODING=yes
EOF

exit 0
