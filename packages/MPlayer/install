#!/bin/sh

. config/options

$SCRIPTS/install ffmpeg-mt
$SCRIPTS/install freetype $2
$SCRIPTS/install lirc $2
$SCRIPTS/install dvb-apps $2
$SCRIPTS/install libdvdnav $2
$SCRIPTS/unpack theme-$THEME

mkdir -p $INSTALL/etc/mplayer
mkdir -p $INSTALL/usr/bin
mkdir -p $INSTALL/usr/share/mplayer

cp $BUILD/$1*/mplayer $INSTALL/usr/bin
if [ "$GUI" = enna ]; then
  cp $PACKAGES/$1/config/mplayer.enna $INSTALL/etc/mplayer/mplayer.conf
else
  cp $PACKAGES/$1/config/mplayer.conf $INSTALL/etc/mplayer
fi
cp $PACKAGES/$1/config/menu.conf $INSTALL/etc/mplayer
cp $PACKAGES/$1/scripts/gen_menu_info $INSTALL/usr/bin
cp $PACKAGES/$1/scripts/mp_set_option $INSTALL/usr/bin
cp $PACKAGES/$1/scripts/mp_loader $INSTALL/usr/bin
cp $PACKAGES/$1/scripts/mp_wrapper $INSTALL/usr/bin
cp $PACKAGES/$1/scripts/cpd $INSTALL/usr/bin
cp $PACKAGES/$1/scripts/playdir $INSTALL/usr/bin
cp $PACKAGES/$1/scripts/play_dvd $INSTALL/usr/bin
cp $PACKAGES/$1/scripts/play_vcd $INSTALL/usr/bin
cp $PACKAGES/$1/config/input.conf $INSTALL/etc/mplayer
cp $PACKAGES/$1/config/dvd $INSTALL/etc
cp $PACKAGES/$1/config/radio $INSTALL/etc

[ "$TARGET_PLATFORM" = easygate ] && sed -i 's%mixer-channel=.*%mixer-channel=PCM%' $INSTALL/etc/mplayer/mplayer.conf

cat <<EOF > $INSTALL/etc/mplayer/no_unstable_vidix
You can enable nvidia/sis vidix driver simply by removing this file.
Vidix should give you better performance especially with low-end hardware.
This feature is not very well tested. That's why it is not enabled by
default. And that's also why you should help us, testing this feature
and reporting your results if you own nvidia/sis hardware.
EOF

mkdir -p $INSTALL/codecs

cp $BUILD/$1*/etc/codecs.conf $INSTALL/etc/mplayer

if [ "$2" != generator ]; then
  cp $BUILD/theme-$THEME/background.avi $INSTALL/usr/share/mplayer
  if [ "$XORG" = yes ]; then
    cp $BUILD/theme-$THEME/background.avi $INSTALL/usr/share/mplayer/background-wide.avi
    [ -f $BUILD/theme-$THEME/background-wide.avi ] && cp $BUILD/theme-$THEME/background-wide.avi $INSTALL/usr/share/mplayer
  fi
  [ -f $BUILD/theme-$THEME/background-audio.avi ] && cp $BUILD/theme-$THEME/background-audio.avi $INSTALL/usr/share/mplayer
fi

exit 0
