#!/bin/sh
#
# put the right font in the right place
#
# runlevels: geexbox, debug, configure

echo "### Setting up fonts ###"

. /etc/lang.conf
. /etc/lang.funcs

readfirstword() {
  head -n 1 $1 | sed 's/^\([[:graph:]]*\).*$/\1/'
}

# set subtitles font according to subfont setting
if test -f /etc/subfont; then
  SUB_CHARSET=`readfirstword /etc/subfont`

  SUB_CHARSET=`lang2charset "$SUB_CHARSET"`
  [ -z "$SUB_CHARSET" ] && exit 1

  SUB_FONT=`lang2font "$SUB_CHARSET" sub`
  SUB_FONT="/usr/share/fonts/$SUB_FONT"
  [ ! -f "$SUB_FONT" ] && exit 1

  mp_set_option subfont "$SUB_FONT"
  mp_set_option subcp "$SUB_CHARSET"
  fribidi_mp_set_option "$SUB_CHARSET"
fi

# set font settings according to theme
if test -f /etc/theme.conf; then
  . /etc/theme.conf

  mp_set_option subfont-osd-scale "$FONT_SIZE"
  [ -f /usr/bin/Xorg -a -f /var/use_xorg ] && mp_set_option subfont-osd-scale 2
fi

exit 0
