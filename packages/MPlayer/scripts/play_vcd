#!/bin/sh

vcd_pls=/tmp/vcd_tracks.pls

# Cleanup
[ -f $vcd_pls ] && rm $vcd_pls

device=${1:-/dev/cdrom}
tracks=`mplayer vcd:///$device -msglevel all=0:identify=4 -vo null -ao null -endpos 0 -nocache | grep ID_VCD_END_TRACK | sed "s%.*=\([0-9]*\).*%\1%"`
[ -z "$tracks" ] && exit 0

i=2
while [ $i -le $tracks ]; do
  echo -e "vcd://$i/$device" >> $vcd_pls
  i=$((i + 1))
done

echo -e "menu hide\nloadlist \"$vcd_pls\"" > /var/mp_control
