#!/bin/sh

device=${1:-/dev/dvd}

# get the longest title
mplayer -identify dvd:// -nosound -novideo 2>&1 | grep ID_DVD_TITLE_ >/tmp/mplayer-identify.out
max_length=`cat /tmp/mplayer-identify.out | sort | sed -e 's/.*=//g' -e 's/\..*//g' | sort -n | tail -n 1`
wanted_title=`cat /tmp/mplayer-identify.out | grep "^.*=$max_length\..*" | head -n 1 | cut -d\_ -f4`

if [ -e /var/dvdnav ]; then
  echo -e "menu hide\nloadfile \"dvdnav:///$device\"" > /var/mp_control
else
  echo -e "menu hide\nloadfile \"dvd://$wanted_title/$device\"" > /var/mp_control
fi
