#!/bin/sh

device=${1:-/dev/dvd}

# get the longest title
dvdid=/tmp/mplayer-identify.out
mplayer -identify dvd:///$device -nosound -novideo -msglevel all=0:global=4:identify=6 2>&1 | grep ID_DVD_TITLE_ > $dvdid
max_length=`cat $dvdid | sort | sed -e 's/.*=//g' -e 's/\..*//g' | sort -n | tail -n 1`
wanted_title=`cat $dvdid | grep "^.*=$max_length\..*" | head -n 1 | cut -d\_ -f4`

if [ -e /var/dvdnav ]; then
  echo -e "menu hide\nloadfile \"dvdnav:///$device\"" > /var/mp_control
else
  echo -e "menu hide\nloadfile \"dvd://$wanted_title/$device\"" > /var/mp_control
fi
