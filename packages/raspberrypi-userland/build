#!/bin/sh

. config/options

cd $BUILD/$1*

mkdir -p objdir-target
cd objdir-target

cmake  \
  -DCMAKE_FIND_ROOT_PATH=$LIB_PREFIX \
  -DCMAKE_INSTALL_PREFIX=/usr \
  -DCMAKE_TOOLCHAIN_FILE=/dev/null \
  -DCMAKE_BUILD_TYPE=Release \
  ..

make
make_install
cp -PR .install/opt/vc .install/usr

if pkg_uses $1 devtools; then
  export SDKSTAGE="$PWD/.install/"
  export CFLAGS="$CFLAGS -I${SDKSTAGE}/opt/vc/include/interface/vmcs_host/linux -I$LIB_PREFIX/include/freetype2"
  export LDFLAGS="$LDFLAGS -L${LIB_PREFIX}/lib -lfreetype -lz -lbz2"
  cd $SDKSTAGE/opt/vc/src/hello_pi
  sh -e rebuild.sh
fi

exit 0

