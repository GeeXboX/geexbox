#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build xorg-protocols
$SCRIPTS/build xorg-libs

cd $BUILD/$1*
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=$LIB_PREFIX \
            --bindir=/usr/bin \
            --sbindir=/usr/sbin \
            --libdir=/usr/lib \
            --enable-shared \
            --disable-werror \
            --disable-debug \
            --disable-builddocs \
            --enable-install-libxf86config \
            --enable-composite \
            --enable-null-root-cursor \
            --enable-shm \
            --disable-xres \
            --disable-xtrap \
            --disable-record \
            --enable-xv \
            --enable-xvmc \
            --enable-dga \
            --disable-screensaver \
            --disable-xdmcp \
            --disable-xdm-auth-1 \
            --enable-glx \
            --disable-aiglx \
            --disable-glx-tls \
            --enable-dri \
            --enable-xinerama \
            --enable-xf86vidmode \
            --enable-xf86misc \
            --disable-xcsecurity \
            --disable-xevie \
            --disable-lbx \
            --disable-appgroup \
            --disable-cup \
            --disable-evi \
            --disable-multibuffer \
            --enable-fontcache \
            --enable-dbe \
            --disable-xf86bigfont \
            --disable-dpms \
            --enable-xinput \
            --enable-xorg \
            --disable-dmx \
            --disable-xvfb \
            --disable-xnest \
            --disable-xwin \
            --disable-xprint \
            --disable-xgl \
            --disable-xglx \
            --disable-xegl \
            --disable-kdrive \
            --disable-xephyr \
            --disable-xsdl \
            --enable-freetype \
            --disable-install-setuid \
            --disable-secure-rpc \
            --disable-xorgconfig \
            --disable-xorgcfg \
            --enable-kbd_mode \
            --with-os-vendor="GeeXboX" \
            --with-int10=x86emu \
            --enable-xfree86-utils \
            --with-mesa-source=`ls -d $ROOT/$BUILD/mesa*` \
            --with-module-dir=$XORG_PATH_MODULES \
            --with-xkb-path=$XORG_PATH_XKB \
            --with-xkb-output=$XORG_PATH_XKB/compiled \
            --with-log-dir=/var/log \
            --with-dri-driver-path=$XORG_PATH_DRI \
            --with-fontdir=$XORG_PATH_FONTS \
            --with-rgb-path=$XORG_PATH_RGB
make
make install \
  XKB_COMPILED_DIR=$SYSROOT_PREFIX/$XORG_PATH_XKB \
  bindir=$LIB_PREFIX/bin sbindir=$LIB_PREFIX/sbin libdir=$LIB_PREFIX/lib \
  DEFAULT_LIBRARY_PATH=$LIB_PREFIX/lib \
  SERVER_MISC_CONFIG_PATH=$LIB_PREFIX/lib/xorg \
  moduledir=$SYSROOT_PREFIX/$XORG_PATH_MODULES
