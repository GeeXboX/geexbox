#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build expat
[ "$XORG" = yes ] && $SCRIPTS/build libX11

export ac_cv_have_abstract_sockets=set

[ "$XORG" = yes ] && WITH_XORG="--with-x" || WITH_XORG="--without-x"

export CFLAGS="$CFLAGS -I$LIB_PREFIX/include"
export LDFLAGS="$LDFLAGS -L$LIB_PREFIX/lib"

cd $BUILD/$1*
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=$LIB_PREFIX \
            --sysconfdir=/etc \
            --datadir=/usr/share \
            --disable-static \
            --enable-shared \
            --disable-tests \
            --disable-ansi \
            --disable-verbose-mode \
            --disable-asserts \
            --disable-checks \
            --disable-qt \
            --disable-qt3 \
            --disable-gtk \
            --disable-xml-docs \
            --disable-doxygen-docs \
            --disable-gcov  \
            --enable-abstract-sockets \
            --disable-selinux \
            --disable-libaudit \
            --disable-dnotify \
            --enable-inotify \
            --with-xml=expat \
            $WITH_XORG \
            --with-session-socket-dir=/var/run/dbus \
            --with-test-socket-dir=/var/run/dbus \
            --with-system-pid-file=/var/run/dbus/pid \
            --with-system-socket=/var/run/dbus/system_bus_socket \
            --with-dbus-user=root \
            --with-dbus-daemondir=/usr/bin \
            --with-dbus-default-reply-timeout=60000 \

make
strip_libs dbus
make -C dbus install
make install-pkgconfigDATA
