#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build libiconv

HOST_BUILD="`ls -d $ROOT/$BUILD/$1*`/host-build"

cd $BUILD/$1*
mkdir host-build
setup_toolchain host
./configure --prefix=$HOST_BUILD
make
make install

setup_toolchain target
ICONV_DIR=`ls -d $ROOT/$BUILD/libiconv*/objdir`
export CFLAGS="-I$ICONV_DIR/include $CFLAGS"
export LDFLAGS="-L$ICONV_DIR/lib $LDFLAGS"
export PATH="$HOST_BUILD/bin:$PATH"

./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=$LIB_PREFIX \
            --enable-shared \
            --disable-static \
            --with-libiconv=gnu \
            --enable-largefiles \
            --enable-debug=no \
            --disable-man \
            --disable-rebuilds \
            --disable-gtk-doc
make
make install
