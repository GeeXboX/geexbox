#!/bin/sh

. config/options

export ac_cv_func_posix_getpwuid_r=yes
export ac_cv_func_posix_getgrgid_r=yes
export glib_cv_stack_grows=no
export glib_cv_uscore=no

cd $BUILD/$1*
mkdir -p objdir-target
cd objdir-target
EXTRA_OPTS=""
[ "$TARGET_LIBC" = "uClibc" ] && EXTRA_OPTS="--with-libiconv=gnu"
../configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=/usr \
            --enable-shared \
            --disable-static \
            --enable-debug=no \
            --disable-man \
            --disable-rebuilds \
            --disable-gtk-doc \
            $EXTRA_OPTS

make
strip_libs glib
strip_libs gobject
strip_libs gmodule
make_install
rm -rf ../.install
mv .install ..
