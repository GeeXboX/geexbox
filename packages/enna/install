#!/bin/sh

install_module () {
  cp $BUILD/$1*/src/modules/$2/$3/.libs/$2_$3.so $INSTALL/usr/lib/enna/modules
}

. config/options

$SCRIPTS/install evas
$SCRIPTS/install ecore
$SCRIPTS/install embryo
$SCRIPTS/install edje
$SCRIPTS/install e_dbus
$SCRIPTS/install elementary
$SCRIPTS/install libxml2
$SCRIPTS/install libplayer
$SCRIPTS/install libvalhalla
$SCRIPTS/install libexif
$SCRIPTS/install libcddb
$SCRIPTS/install enna-theme
$SCRIPTS/install lirc

mkdir -p $INSTALL/usr/bin
cp $BUILD/$1*/src/bin/enna $INSTALL/usr/bin

mkdir -p $INSTALL/usr/lib/enna/modules

if [ "$GAMES" = yes ]; then
  $SCRIPTS/install efreet
  install_module $1 activity games
fi
install_module $1 activity configuration
install_module $1 activity music
install_module $1 activity photo
install_module $1 activity video
if [ "$VDR" = yes ]; then
  $SCRIPTS/install libsvdrp
  install_module $1 activity tv
fi
install_module $1 activity weather

install_module $1 browser cdda
install_module $1 browser dvd
install_module $1 browser localfiles
install_module $1 browser netstreams
install_module $1 browser valhalla

install_module $1 input lirc

install_module $1 volume hal

for loc in $INCLUDED_LOCALES; do
  LOCALE=`echo $loc|cut -f1 -d.`
  [ ! -r $BUILD/$1*/po/$LOCALE.gmo ] && \
    LOCALE=`echo $loc|cut -f1 -d_`

  if [ -r $BUILD/$1*/po/$LOCALE.gmo ]; then
    mkdir -p $INSTALL/usr/share/locale/$LOCALE/LC_MESSAGES
    cp $BUILD/$1*/po/$LOCALE.gmo \
      $INSTALL/usr/share/locale/$LOCALE/LC_MESSAGES/$1.mo
  fi
done

mkdir -p $INSTALL/etc
cp $PACKAGES/enna/config/enna.cfg $INSTALL/etc

cp $CONFIG/lsb-release $INSTALL/etc
sed -i s%release-nr%$GEEXBOX_VERSION% $INSTALL/etc/lsb-release
