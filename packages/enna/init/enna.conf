description  "configure and start Enna"
author       "GeeXboX"

start on runlevel geexbox and started mplayer-config and started lircd and started persistent-data \
  and ( mode hdtv and started xorg ) \
  or ( mode console )
stop on shutdown or stopping xorg
respawn

env ENV

pre-start script
  . /etc/funcs

  make_persistent file /etc/enna.cfg /var/data/config/enna.cfg
  make_persistent file /etc/xine/config /var/data/config/xine-config
  mkdir -p /root/.enna && make_persistent file /root/.enna/media.db /var/data/enna/media.db
  
  if [ "$MODE" = console ]; then
    sed_in_place /etc/enna.cfg 's%engine=.*%engine=fb%'
  elif [ -f /var/use_opengl ]; then
    sed_in_place /etc/enna.cfg 's/engine=software_x11/engine=opengl_x11/'
  fi
 
  exit 0
end script

exec runenna $MODE
