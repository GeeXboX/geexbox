#!/bin/sh

. config/options

$SCRIPTS/build toolchain
[ "$TARGET_LIBC" = "uClibc" ] && $SCRIPTS/build libiconv
$SCRIPTS/build dbus

cd $BUILD/$1*

# build for host for nih-dbus-tool
mkdir -p objdir-host
cd objdir-host
setup_toolchain host
../configure --enable-static --disable-shared
make
cp -f nih-dbus-tool/nih-dbus-tool $ROOT/$TOOLCHAIN/bin

# build for target
cd ..
mkdir -p objdir-target
cd objdir-target
setup_toolchain target
export NIH_DBUS_TOOL="$ROOT/$TOOLCHAIN/bin/nih-dbus-tool"
../configure --host=$TARGET_NAME \
             --build=$HOST_NAME \
             --prefix=$LIB_PREFIX \
             --enable-static \
             --disable-shared \
             --disable-nls \
             --enable-threading
make
make install
