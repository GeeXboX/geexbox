#!/bin/sh

. config/options

$SCRIPTS/build zlib
$SCRIPTS/build jpeg
$SCRIPTS/build libungif
$SCRIPTS/build freetype
$SCRIPTS/build lirc

[ "$XORG" = yes ] && CFG_X11="--enable-x11" || CFG_X11="--disable-x11"
[ "$SDL" = yes ] && CFG_SDL="--enable-sdl" || CFG_SDL="--disable-sdl"
[ "$TARGET_ARCH" = arm ] && CFG_GFX_DRV="gl,omap" || CFG_GFX_DRV="all"

if [ "$DEBUG" = yes ]; then
  CFG_DEBUG="--enable-debug --enable-debug-support"
else
  CFG_DEBUG="--disable-debug --disable-debug-support"
fi

cd $BUILD/$1*
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=/usr \
            --sysconfdir=/etc \
            --enable-shared \
            --disable-static \
            --enable-largefile \
            --disable-osx \
            $CFG_X11 \
            $CFG_DEBUG \
            --enable-text \
            --enable-gettid \
            --enable-network \
            --enable-devmem \
            --enable-fbdev \
            $CFG_SDL \
            --disable-vnc \
            --enable-sysfs \
            --enable-jpeg \
            --enable-zlib \
            --disable-png \
            --enable-gif \
            --enable-freetype \
            --enable-video4linux2 \
            --with-gfxdrivers=$CFG_GFX_DRV \
            --with-inputdrivers=all \
            --with-smooth-scaling \
            --without-tests \
            --without-tools \

make
strip_libs .
make_install
cp -P directfb-config $ROOT/$TOOLCHAIN/bin
