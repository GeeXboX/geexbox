#!/bin/sh

xine_install () {
  PLUGIN_PATH="$1"
  PLUGIN_NAME="xineplug_$2"
  INSTALL_PATH="$INSTALL/usr/lib/xine/plugins/2.0/$3"

  mkdir -p "$INSTALL_PATH"
  cp $BUILD/xine-lib*/src/$PLUGIN_PATH/.libs/${PLUGIN_NAME}*.so "$INSTALL_PATH"
}

. config/options

$SCRIPTS/install zlib
$SCRIPTS/install libiconv
$SCRIPTS/install ffmpeg
$SCRIPTS/install freetype
[ "$DEVTOOLS" = yes ] && $SCRIPTS/install xine-ui

mkdir -p $INSTALL/usr/lib
cp -PR $BUILD/$1*/src/xine-engine/.libs/libxine*.so* $INSTALL/usr/lib

xine_install audio_dec decode_mad
xine_install audio_out ao_out_alsa
xine_install audio_out ao_out_none
xine_install demuxers "dmx_mpeg*"
xine_install input inp_dvd

[ "$DEVTOOLS" = yes ] && xine_install input inp_file

xine_install combined/ffmpeg decode_ff
xine_install spu_dec "*"
xine_install video_dec/libmpeg2 decode_mpeg2

[ "$VDPAU" = yes ] && xine_install video_dec/libvdpau "decode_vdpau_*"
xine_install video_out vo_out_none
[ "$CONSOLE" = yes ] && xine_install video_out vo_out_fb
[ "$XORG" = yes ] && xine_install video_out "vo_out_x*"
[ "$XORG" = yes ] && xine_install video_out vo_out_opengl
[ "$VDPAU" = yes ] && xine_install video_out vo_out_vdpau
[ "$VDR" = yes ] && xine_install vdr vdr

xine_install post/audio post_audio_filters post
xine_install post/deinterlace post_tvtime post
xine_install post/planar post_planar post

mkdir -p $INSTALL/etc/xine
cp $PACKAGES/$1/config/config $INSTALL/etc/xine
[ "$VDPAU" = yes ] && \
  echo "engine.buffers.video_num_frames: 22" >> $INSTALL/etc/xine/config

exit 0
