#!/bin/sh
#
# setup the ASUS EeePC
#
# runlevels: geexbox, debug, configure

unload_wifi() {
   rmmod wlan_scan_sta
   rmmod wlan_tkip
   rmmod wlan_wep
   rmmod wlan_ccmp
   rmmod wlan_acl
   rmmod ath_pci
   sleep 1
   rmmod ath_rate_atheros
   rmmod ath_hal
   rmmod wlan
   rmmod ath_dfs
}

load_wifi() {
   modprobe ath_pci
}

wifi_on() {
   unload_wifi
   # Force PCI Express Hotplug to reinit
   rmmod pciehp
   sleep 1
   # pciehp_force may be unnecessary; Xandros did it.
   modprobe pciehp pciehp_force=1
   sleep 1
   # Switch on the hardware
   echo 1 > /sys/devices/platform/eeepc/wlan
   sleep 1
   load_wifi
}

dmidecode | grep -q "Serial Number: EeePC" && dmidecode | grep -q "Product Name: 70" || exit 1

echo "### Setting up ASUS EeePC ###"

exit 0
