#!/bin/sh
#
# mount nfs shares
#
# runlevels: geexbox, debug

IFS='
'

if test -f /etc/nfs; then
  echo "### Mounting NFS shares ###"
  (
    while [ ! -f /var/ifup ]; do
      sleep 5
    done 
    while true; do
      for MOUNTS in `grep -v "^#" /etc/nfs | grep -v "^$"`; do
        SRV="`echo $MOUNTS | sed 's/[ ]*\([^ ]*\)[ ]*.*/\1/'`"
        DIR="`echo $MOUNTS | sed 's/[ ]*[^ ]*[ ]*\([^ ]*\)/\1/'`"
        if [ ! -e "/mnt/nfs/$DIR" ]; then
          mkdir -p "/mnt/nfs/$DIR"
          mount -t nfs -o ro,nolock,nfsvers=2 "$SRV" "/mnt/nfs/$DIR" >/dev/null 2>&1 || rmdir -p "/mnt/nfs/$DIR"
        fi
      done
      sleep 180
    done
  )&
fi

exit 0
