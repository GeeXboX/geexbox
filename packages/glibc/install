#!/bin/sh

. config/options

if [ "$2" = toolchain ]; then
  rm -rf "$SYSROOT_PREFIX/lib" "$SYSROOT_PREFIX/usr/lib" "$SYSROOT_PREFIX/usr/include"
  $SCRIPTS/install linux-headers

  cd $BUILD/$1*/objdir-$1
  cat >configparms <<EOF
install_root=$SYSROOT_PREFIX
EOF
  make install
  exit 0
fi

mkdir -p $INSTALL/lib $INSTALL/bin

cp $BUILD/$1*/objdir-$1/elf/ld*.so.* $INSTALL/lib
cp $BUILD/$1*/objdir-$1/libc.so.6 $INSTALL/lib
cp $BUILD/$1*/objdir-$1/dlfcn/libdl.so.2 $INSTALL/lib
cp $BUILD/$1*/objdir-$1/nptl/libpthread.so.0 $INSTALL/lib
[ "$GDB" = yes ] && cp $BUILD/$1*/objdir-$1/nptl_db/libthread_db.so.1 $INSTALL/lib
[ "$DEVTOOLS" = yes ] && cp $BUILD/$1*/objdir-$1/elf/ldd $INSTALL/bin
cp $BUILD/$1*/objdir-$1/math/libm.so.6 $INSTALL/lib
cp $BUILD/$1*/objdir-$1/login/libutil.so.1 $INSTALL/lib
if [ "$NETWORK" = yes ]; then
  cp $BUILD/$1*/objdir-$1/crypt/libcrypt.so.1 $INSTALL/lib
  cp $BUILD/$1*/objdir-$1/resolv/libresolv.so.2 $INSTALL/lib
  cp $BUILD/$1*/objdir-$1/resolv/libnss_dns.so.2 $INSTALL/lib
  cp $BUILD/$1*/objdir-$1/nis/libnsl.so.1 $INSTALL/lib
  cp $BUILD/$1*/objdir-$1/nis/libnss_compat.so.2 $INSTALL/lib
  cp $BUILD/$1*/objdir-$1/nss/libnss_files.so.2 $INSTALL/lib
fi
[ "$XORG" = yes -o "$VDR" = yes ] && cp $BUILD/$1*/objdir-$1/rt/librt.so.1 $INSTALL/lib

if [ "$INCLUDED_TIMEZONES" = all ]; then
  mkdir -p $INSTALL/usr/share/zoneinfo
  cp -r $SYSROOT_PREFIX/usr/share/zoneinfo/* $INSTALL/usr/share/zoneinfo
elif [ -n "$INCLUDED_TIMEZONES" ]; then
  for tz in $INCLUDED_TIMEZONES; do
    TZDIR=`dirname $INSTALL/usr/share/zoneinfo/$tz`
    mkdir -p $TZDIR
    cp -r $SYSROOT_PREFIX/usr/share/zoneinfo/$tz $TZDIR
  done
fi

if [ -f $INSTALL/usr/share/zoneinfo/$TIMEZONE ]; then
  mkdir -p $INSTALL/etc
  ln -s /usr/share/zoneinfo/$TIMEZONE $INSTALL/etc/localtime
fi

exit 0
