#!/bin/sh

. config/options

$SCRIPTS/build toolchain

CFLAGS="$CFLAGS -I`ls -d $ROOT/$BUILD/$1*`/libinstaller"
CFLAGS="$CFLAGS -I`ls -d $ROOT/$BUILD/$1*`/libfat"

SUBDIRS="codepage core libinstaller mtools"
[ $TARGET_ARCH = i386 ] && SUBDIRS="$SUBDIRS mbr"

make -C $BUILD/$1* \
     CC=$CC \
     AR=$AR \
     RANLIB=$RANLIB \
     CFLAGS="$CFLAGS -fomit-frame-pointer -D_FILE_OFFSET_BITS=64" \
     LDFLAGS="$LDFLAGS" \
     BSUBDIRS="$SUBDIRS"

make -C $BUILD/$1*/com32 CC=$CC
