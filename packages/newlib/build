#!/bin/sh

. config/options

$SCRIPTS/build toolchain

TARGET_PREFIX="$ROOT/$TOOLCHAIN/bin/spu-"
export CC_FOR_TARGET=${TARGET_PREFIX}gcc
export LD_FOR_TARGET=${TARGET_PREFIX}ld
export AS_FOR_TARGET=${TARGET_PREFIX}as
export AR_FOR_TARGET=${TARGET_PREFIX}ar
export NM_FOR_TARGET=${TARGET_PREFIX}nm
export RANLIB_FOR_TARGET=${TARGET_PREFIX}ranlib
export OBJCOPY_FOR_TARGET=${TARGET_PREFIX}objcopy
export STRIP_FOR_TARGET=${TARGET_PREFIX}strip
export CFLAGS="-O2 -Wall -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE"

cd $BUILD/$1*
mkdir -p objdir-spu
cd objdir-spu
../configure --build=$HOST_NAME \
             --host=$TARGET_NAME \
             --target=spu \
             --prefix=$ROOT/$TOOLCHAIN \
             --with-as=$ROOT/$TOOLCHAIN/bin/spu-as \
             --with-ld=$ROOT/$TOOLCHAIN/bin/spu-ld \
             --enable-stage1-languages=c \
             --enable-static \
             --disable-shared \
             --disable-libada \
             --disable-libssp \
             --enable-multilib \
             --disable-nls \
             --with-build-sysroot=$SYSROOT_PREFIX \

make
