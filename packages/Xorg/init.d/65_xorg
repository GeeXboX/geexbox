#!/bin/sh
#
# configure X.Org video settings
#
# runlevels: geexbox, debug

XORG_CFG=/etc/X11/X.cfg

if [ -f /usr/bin/Xorg -a -f /usr/bin/xorgconfig ]; then
  echo "### Configuring X.Org video settings ###"

  grep -q xorg /proc/cmdline && XORG=`sed 's/.*xorg=\([^\ ]*\).*/\1/' /proc/cmdline`
  if [ -n "$XORG" ]; then
    XRES=`echo $XORG | sed 's%\(.*\)x.*%\1%'`
    sed -i "s%XORG_RESX=.*%XORG_RESX=$XRES%" $XORG_CFG

    YRES=`echo $XORG | sed 's%.*x\(.*\)@.*%\1%'`
    sed -i "s%XORG_RESY=.*%XORG_RESY=$YRES%" $XORG_CFG

    RATE=`echo $XORG | sed 's%.*@\(.*\)%\1%'`
    sed -i "s%XORG_RATE=.*%XORG_RATE=$RATE%" $XORG_CFG
  fi

  xorgconfig > /dev/null 2>&1
fi

exit 0
