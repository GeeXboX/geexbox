#!/bin/sh

. config/options

$SCRIPTS/build toolchain

BUSYBOX=`ls -d $BUILD/$1*`

cp $PACKAGES/$1/config/$1.conf $BUSYBOX/.config

[ -n "$TIMEZONE" ] && sed -i -e 's/^# CONFIG_HWCLOCK .*$/CONFIG_HWCLOCK=yes/g' -e 's/^# CONFIG_FEATURE_HWCLOCK_LONG_OPTIONS .*/CONFIG_FEATURE_HWCLOCK_LONG_OPTIONS=yes/g' $BUSYBOX/.config

if [ "$INSTALLATOR" = yes ]; then
  for option in CONFIG_CPIO CONFIG_FEATURE_CPIO_O CONFIG_FEATURE_CPIO_P CONFIG_GUNZIP CONFIG_FEATURE_FIND_XDEV CONFIG_FEATURE_FIND_MAXDEPTH CONFIG_SWITCH_ROOT; do
    sed -i -e "s/^# $option .*\$/$option=y/g" $BUSYBOX/.config
  done
fi

make -C $BUSYBOX oldconfig HOSTCC=$HOST_CC
