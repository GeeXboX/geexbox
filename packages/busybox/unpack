#!/bin/sh

. config/options

$SCRIPTS/build toolchain

BUSYBOX=`ls -d $BUILD/$1*`

cat <<EOF >$BUSYBOX/Makefile.custom
HOSTCC = $HOST_CC
CROSS_COMPILE = $TARGET_PREFIX
CFLAGS += -std=gnu99 
EOF

cp $PACKAGES/$1/config/$1.conf $BUSYBOX/.config

[ -n "$TIMEZONE" ] && sed -i -e 's/^# CONFIG_HWCLOCK .*$/CONFIG_HWCLOCK=yes/g' -e 's/^# CONFIG_FEATURE_HWCLOCK_LONG_OPTIONS .*/CONFIG_FEATURE_HWCLOCK_LONG_OPTIONS=yes/g' $BUSYBOX/.config

make -C $BUSYBOX oldconfig
