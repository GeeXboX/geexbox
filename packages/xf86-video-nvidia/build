#!/bin/sh

. config/options

require_glibc $1

$SCRIPTS/build toolchain
$SCRIPTS/build linux

cd $BUILD/$1/usr/src/nv
make module CC=$CC SYSSRC=$(kernel_path) SYSOUT=$(kernel_path)

if [ "$VDPAU" = yes ]; then
  cd ../../..
  mkdir -p $LIB_PREFIX/include/vdpau
  cp -f usr/include/vdpau/*.h $LIB_PREFIX/include/vdpau

  for vdpaulib in vdpau_nvidia vdpau vdpau_trace; do
    cp -P usr/lib/lib${vdpaulib}.so* $LIB_PREFIX/lib/lib${vdpaulib}.so.1
    ln -sf lib${vdpaulib}.so.1 $LIB_PREFIX/lib/lib${vdpaulib}.so
done
