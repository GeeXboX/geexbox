#!/bin/sh
#
# Load ndiswrapper
#
# runlevels: geexbox, debug

DIR=/etc/ndiswrapper

if [ `ls $DIR | grep -c -e ".*"` -gt 0 ]; then
  echo "### Loading NdisWrapper drivers ###"

  # Make loadndisdriver binary available in expected location
  ln -s /bin/loadndisdriver /sbin/loadndisdriver

  for DRVDIR in $DIR/*; do
    [ ! -f "$DRVDIR/ndiswrapper" ] && continue
    cat "$DRVDIR/ndiswrapper" | while read FILE LN; do
      ln -s "$DRVDIR/$FILE" "$DRVDIR/$LN"
    done
  done
  modprobe ndiswrapper
fi

exit 0
