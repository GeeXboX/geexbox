#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build GLib
$SCRIPTS/build libusb
$SCRIPTS/build attr

UTILS="ata_id cdrom_id edd_id path_id scsi_id usb_id"
for i in $UTILS; do
  EXTRAS="$EXTRAS extras/$i/$i"
done

#--pci-ids-path doesn't work right now
export ac_cv_file__usr_share_pci_ids="yes"
export ac_cv_file__usr_share_hwdata_pci_ids="no"
export ac_cv_file__usr_share_misc_pci_ids="no"

cd $BUILD/$1*
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --enable-silent-rules \
            --enable-extras \
            --disable-introspection \
            --prefix=/usr \
            --sysconfdir=/etc \
            --sbindir=/sbin \
            --libdir=/usr/lib \
            --with-rootlibdir=/lib \
            --libexecdir=/lib/udev \
            --mandir=/usr/share/man \
            --infodir=/usr/share/info \
            --without-selinux \
            --disable-static \
            --enable-shared \
            --disable-gtk-doc \

#            --pci-ids-path=/usr/share/pci.ids \

for t in udev/udevadm udev/udevd; do
  make $t
done

for i in $EXTRAS; do
  make $i
done

mkdir -p $LIB_PREFIX/include
mkdir -p $LIB_PREFIX/lib/pkgconfig

