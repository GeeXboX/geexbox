diff -Naur samba-3.0.25.orig/source/include/debug.h samba-3.0.25/source/include/debug.h
--- samba-3.0.25.orig/source/include/debug.h	2007-05-17 12:28:16.000000000 +0200
+++ samba-3.0.25/source/include/debug.h	2007-05-17 12:31:32.000000000 +0200
@@ -162,54 +162,18 @@
  * will remove the extra conditional test.
  */
 
-#define DEBUGLVL( level ) \
-  ( ((level) <= MAX_DEBUG_LEVEL) && \
-     ((DEBUGLEVEL_CLASS[ DBGC_CLASS ] >= (level))||  \
-     (!DEBUGLEVEL_CLASS_ISSET[ DBGC_CLASS ] && \
-      DEBUGLEVEL_CLASS[ DBGC_ALL   ] >= (level))  ) \
-   && dbghdr( level, __FILE__, FUNCTION_MACRO, (__LINE__) ) )
-
-
-#define DEBUGLVLC( dbgc_class, level ) \
-  ( ((level) <= MAX_DEBUG_LEVEL) && \
-     ((DEBUGLEVEL_CLASS[ dbgc_class ] >= (level))||  \
-     (!DEBUGLEVEL_CLASS_ISSET[ dbgc_class ] && \
-      DEBUGLEVEL_CLASS[ DBGC_ALL   ] >= (level))  ) \
-   && dbghdr( level, __FILE__, FUNCTION_MACRO, (__LINE__) ) )
-
-
-#define DEBUG( level, body ) \
-  (void)( ((level) <= MAX_DEBUG_LEVEL) && \
-           ((DEBUGLEVEL_CLASS[ DBGC_CLASS ] >= (level))||  \
-           (!DEBUGLEVEL_CLASS_ISSET[ DBGC_CLASS ] && \
-            DEBUGLEVEL_CLASS[ DBGC_ALL   ] >= (level))  ) \
-       && (dbghdr( level, __FILE__, FUNCTION_MACRO, (__LINE__) )) \
-       && (dbgtext body) )
-
-#define DEBUGC( dbgc_class, level, body ) \
-  (void)( ((level) <= MAX_DEBUG_LEVEL) && \
-           ((DEBUGLEVEL_CLASS[ dbgc_class ] >= (level))||  \
-           (!DEBUGLEVEL_CLASS_ISSET[ dbgc_class ] && \
-	    DEBUGLEVEL_CLASS[ DBGC_ALL   ] >= (level))  ) \
-       && (dbghdr( level, __FILE__, FUNCTION_MACRO, (__LINE__) )) \
-       && (dbgtext body) )
-
-#define DEBUGADD( level, body ) \
-  (void)( ((level) <= MAX_DEBUG_LEVEL) && \
-           ((DEBUGLEVEL_CLASS[ DBGC_CLASS ] >= (level))||  \
-           (!DEBUGLEVEL_CLASS_ISSET[ DBGC_CLASS ] && \
-            DEBUGLEVEL_CLASS[ DBGC_ALL   ] >= (level))  ) \
-       && (dbgtext body) )
-
-#define DEBUGADDC( dbgc_class, level, body ) \
-  (void)( ((level) <= MAX_DEBUG_LEVEL) && \
-          ((DEBUGLEVEL_CLASS[ dbgc_class ] >= (level))||  \
-           (!DEBUGLEVEL_CLASS_ISSET[ dbgc_class ] && \
-            DEBUGLEVEL_CLASS[ DBGC_ALL   ] >= (level))  ) \
-       && (dbgtext body) )
-
-/* Print a separator to the debug log. */
-#define DEBUGSEP(level)\
-	DEBUG((level),("===============================================================\n"))
+#define DEBUGLVL( level )  (0)
+
+#define DEBUGLVLC( dbgc_class, level )  (0)
+
+#define DEBUG( level, body )  ((void)0)
+
+#define DEBUGC( dbgc_class, level, body )  ((void)0)
+
+#define DEBUGADD( level, body )  ((void)0)
+
+#define DEBUGADDC( dbgc_class, level, body )  ((void)0)
+
+#define DEBUGSEP( level )  ((void)0)
 
 #endif
diff -Naur samba-3.0.25.orig/source/libsmb/clierror.c samba-3.0.25/source/libsmb/clierror.c
--- samba-3.0.25.orig/source/libsmb/clierror.c	2007-05-17 12:28:16.000000000 +0200
+++ samba-3.0.25/source/libsmb/clierror.c	2007-05-17 12:32:35.000000000 +0200
@@ -159,7 +159,7 @@
 	if (flgs2 & FLAGS2_32_BIT_ERROR_CODES) {
 		NTSTATUS status = NT_STATUS(IVAL(cli->inbuf,smb_rcls));
 
-		return nt_errstr(status);
+		return "NT_STATUS_UNSUCCESSFUL";
         }
 
 	cli_dos_error(cli, &errclass, &errnum);
diff -Naur samba-3.0.25.orig/source/Makefile.in samba-3.0.25/source/Makefile.in
--- samba-3.0.25.orig/source/Makefile.in	2007-05-17 12:28:16.000000000 +0200
+++ samba-3.0.25/source/Makefile.in	2007-05-17 12:37:56.000000000 +0200
@@ -530,12 +530,7 @@
 	$(SECRETS_OBJ) $(LIBSAMBA_OBJ) $(RPC_PARSE_OBJ1) $(DOSERR_OBJ) \
 	$(PRINTBASE_OBJ) $(ERRORMAP_OBJ)
 
-SMBTREE_OBJ = utils/smbtree.o $(PARAM_OBJ) \
-             $(PROFILE_OBJ) $(LIB_NONSMBD_OBJ) $(LIBSMB_OBJ) \
-	     $(KRBCLIENT_OBJ) $(POPT_LIB_OBJ) $(SECRETS_OBJ) \
-             rpc_client/cli_pipe.o $(RPC_PARSE_OBJ2) \
-             $(RPC_CLIENT_OBJ1) \
-	     $(LIBMSRPC_GEN_OBJ)
+SMBTREE_OBJ = utils/smbtree.o $(POPT_LIB_OBJ) $(SECRETS_OBJ)
 
 TESTPARM_OBJ = utils/testparm.o \
                $(PARAM_OBJ) $(LIB_NONSMBD_OBJ) $(POPT_LIB_OBJ) \
@@ -635,8 +630,7 @@
 CUPS_OBJ = client/smbspool.o $(PARAM_OBJ) $(LIBSMB_OBJ) \
 	  $(LIB_NONSMBD_OBJ) $(KRBCLIENT_OBJ) $(SECRETS_OBJ)
 
-MOUNT_OBJ = client/smbmount.o \
-             $(PARAM_OBJ) $(LIBSMB_OBJ) $(KRBCLIENT_OBJ) $(LIB_NONSMBD_OBJ) $(SECRETS_OBJ)
+MOUNT_OBJ = client/smbmount.o
 
 MNT_OBJ = client/smbmnt.o $(VERSION_OBJ) $(LIBREPLACE_OBJ) $(SOCKET_WRAPPER_OBJ)
 
@@ -1002,9 +996,9 @@
 	@echo Linking $@
 	@$(CC) $(FLAGS) -o $@ $(CUPS_OBJ) $(DYNEXP) $(LDFLAGS) $(LIBS) $(KRB5LIBS) $(LDAP_LIBS)
 
-bin/smbmount@EXEEXT@: proto_exists $(MOUNT_OBJ) bin/.dummy
+bin/smbmount@EXEEXT@: proto_exists $(MOUNT_OBJ) bin/libsmbclient.so bin/.dummy
 	@echo Linking $@
-	@$(CC) $(FLAGS) -o $@ $(MOUNT_OBJ) $(DYNEXP) $(LDFLAGS) $(LIBS) $(KRB5LIBS) $(LDAP_LIBS)
+	@$(CC) $(FLAGS) -o $@ $(MOUNT_OBJ) $(DYNEXP) $(LDFLAGS) $(LIBS) $(KRB5LIBS) $(LDAP_LIBS) -Lbin -lsmbclient
 
 bin/smbmnt@EXEEXT@: proto_exists $(MNT_OBJ) bin/.dummy
 	@echo Linking $@
@@ -1037,9 +1031,9 @@
 	$(SMBCONTROL_OBJ) $(DYNEXP) $(LDFLAGS) \
 	$(LIBS) $(LDAP_LIBS) @LIBUNWIND_PTRACE@ @POPTLIBS@
 
-bin/smbtree@EXEEXT@: proto_exists $(SMBTREE_OBJ) @BUILD_POPT@ bin/.dummy
+bin/smbtree@EXEEXT@: proto_exists $(SMBTREE_OBJ) bin/libsmbclient.so @BUILD_POPT@ bin/.dummy
 	@echo Linking $@
-	@$(CC) $(FLAGS) -o $@ $(SMBTREE_OBJ) $(LDFLAGS) $(DYNEXP) $(LIBS) @POPTLIBS@ $(KRB5LIBS) $(LDAP_LIBS)
+	@$(CC) $(FLAGS) -o $@ $(SMBTREE_OBJ) $(LDFLAGS) $(DYNEXP) $(LIBS) @POPTLIBS@ $(KRB5LIBS) $(LDAP_LIBS) -Lbin -lsmbclient
 
 bin/smbpasswd@EXEEXT@: proto_exists $(SMBPASSWD_OBJ) @BUILD_POPT@ bin/.dummy
 	@echo Linking $@
@@ -1160,7 +1154,7 @@
 
 bin/libsmbclient.a: proto_exists $(LIBSMBCLIENT_OBJ)
 	@echo Linking libsmbclient non-shared library $@
-	@-$(AR) -rc $@ $(LIBSMBCLIENT_OBJ)
+	@-$(AR) -rc $@ $(LIBSMBCLIENT_OBJ) $(KRB5LIBS) $(LDAPLIBS)
 
 bin/libsmbsharemodes.@SHLIBEXT@: proto_exists $(LIBSMBSHAREMODES_OBJ)
 	@echo Linking libsmbsharemodes shared library $@
diff -Naur samba-3.0.25.orig/source/utils/smbtree.c samba-3.0.25/source/utils/smbtree.c
--- samba-3.0.25.orig/source/utils/smbtree.c	2007-05-17 12:28:16.000000000 +0200
+++ samba-3.0.25/source/utils/smbtree.c	2007-05-17 12:38:37.000000000 +0200
@@ -127,6 +127,7 @@
         return True;
 }
 
+#if 0
 static BOOL get_rpc_shares(struct cli_state *cli, 
 			   void (*fn)(const char *, uint32, const char *, void *),
 			   void *state)
@@ -179,7 +180,7 @@
 	cli_rpc_pipe_close(pipe_hnd);
 	return True;
 }
-
+#endif
 
 static BOOL get_shares(char *server_name, struct user_auth_info *user_info)
 {
@@ -188,9 +189,6 @@
         if (!(cli = get_ipc_connect(server_name, NULL, user_info)))
                 return False;
 
-	if (get_rpc_shares(cli, add_name, &shares))
-		return True;
-	
         if (!cli_RNetShareEnum(cli, add_name, &shares))
                 return False;
 
