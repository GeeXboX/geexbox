#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build libiconv

export samba_cv_HAVE_GETTIMEOFDAY_TZ=yes
export samba_cv_USE_SETEUID=yes
export samba_cv_HAVE_IFACE_IFCONF=yes
export SMB_BUILD_CC_NEGATIVE_ENUM_VALUES=no

[ "$LIBSTRIP" = yes ] && SMB_LIB_EXT=a || SMB_LIB_EXT=so

cd $BUILD/$1*/source
./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --disable-pie \
            --disable-cups \
            --without-smbmount \
            --with-cifsmount \
            --without-ldap \
            --without-winbind \
            --with-included-popt \
            --with-libsmbclient \
            --without-ads \
            --without-quotas \
            --without-sys-quotas \
            --with-libiconv=$LIB_PREFIX \
            --localstatedir=/var \
            --with-configdir=/etc \
            --with-privatedir=/etc

make include/proto.h
make \
     bin/mount.cifs \
     bin/smbtree \
     bin/libsmbclient.$SMB_LIB_EXT
