#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/install lzo

mkdir -p $INSTALL/usr/share
tar cf - -C $BUILD/$1*/__build "." | lzma e $INSTALL/usr/share/grub-i386-pc.tar.lzma -si -a2 || exit 1

mkdir -p $INSTALL/etc/grub
cp $PACKAGES/$1/config/grub.cfg $INSTALL/etc/grub

if [ "$2" != generator ]; then
  $SCRIPTS/unpack theme-$THEME

  [ -f "$BUILD/theme-$THEME/grub-splash.xpm.gz" ] && cp $BUILD/theme-$THEME/grub-splash.xpm.gz $INSTALL/usr/share/grub-splash.xpm.gz
  [ -f "$BUILD/theme-$THEME/grub-splash.png" ] && cp $BUILD/theme-$THEME/grub-splash.png $INSTALL/usr/share/grub-splash.png
fi

exit 0
