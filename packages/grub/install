#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/install lzo

mkdir -p $INSTALL/usr/share
# mod files have to be stripped (debugging symbols) in any case, otherwise grub isn't installable anymore
find $BUILD/$1*/__build/ -name "*.mod" -exec $HOST_STRIP -d {} \;
tar cf - -C $BUILD/$1*/__build "." | lzma -9 -c > $INSTALL/usr/share/grub-i386-pc.tar.lzma || exit 1

mkdir -p $INSTALL/etc/grub
cp $PACKAGES/$1/config/grub.cfg $INSTALL/etc/grub
cp $PACKAGES/$1/config/grub-splash.png $INSTALL/usr/share/grub-splash.png

exit 0
