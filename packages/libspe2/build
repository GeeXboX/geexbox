#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build toolchain-spu

setup_toolchain target
export MAKEFLAGS=-j1

cd $BUILD/$1*

make \
  ARCH=ppc64 \
  CROSS_COMPILE=1 \
  CROSS="${TARGET_PREFIX}" \
  SPU_CROSS="$ROOT/$TOOLCHAIN/bin/spu-" \
  SYSROOT="$ROOT/$TOOLCHAIN/$TARGET_NAME/sysroot" \
  prefix="$LIB_PREFIX"

make install \
     SYSROOT="$ROOT/$TOOLCHAIN/$TARGET_NAME/sysroot" \
     prefix="$LIB_PREFIX"

# ugly hack to use static library only
rm -f "$LIB_PREFIX/lib/libspe*.so*"
