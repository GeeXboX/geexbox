#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build xorg-libs
$SCRIPTS/build intel-gen4asm

cd $BUILD/$1*

DRIVERS_CONFIG="--disable-dummy-driver --disable-i965-driver"

[ "$VAAPI_DRIVERS" = all ] && VAAPI_DRIVERS="dummy i965"
for d in $VAAPI_DRIVERS; do
  DRIVERS_CONFIG="$DRIVERS_CONFIG --enable-$d-driver"
done

./configure --host=$TARGET_NAME \
            --build=$HOST_NAME \
            --prefix=$LIB_PREFIX \
            --enable-shared \
            --disable-static \
            --with-drivers-path=/usr/lib/va/drivers/ \
            --enable-glx \
            $DRIVERS_CONFIG

make
strip_libs va i965_drv_video dummy_drv_video test
make -C va install
cp -f *.pc $LIB_PREFIX/lib/pkgconfig
