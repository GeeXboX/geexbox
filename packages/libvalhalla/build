#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build sqlite
$SCRIPTS/build ffmpeg
$SCRIPTS/build libexif
$SCRIPTS/build libxml2
$SCRIPTS/build libnfo
$SCRIPTS/build curl

if [ "$DEBUG" = yes ]; then
  DEBUG_CONFIG="--enable-debug=3"
else
  DEBUG_CONFIG="--disable-debug"
fi

cd $BUILD/$1*
CPPFLAGS="$CPPFLAGS -DCURL_STATICLIB" \
LDFLAGS="$LDFLAGS -lz -ldl" \
./configure --prefix=$LIB_PREFIX \
            --enable-static \
            --disable-shared \
            --cross-compile \
            --disable-optimize \
            --disable-doc \
            --disable-logcolor \
            --enable-grabbers \
            $DEBUG_CONFIG \

make -C src
[ "$DEVTOOLS" = yes ] && make apps
make -C src install
cp -f libvalhalla.pc $LIB_PREFIX/lib/pkgconfig/
