#!/bin/sh

. config/options

$SCRIPTS/build toolchain
$SCRIPTS/build sqlite
$SCRIPTS/build ffmpeg
$SCRIPTS/build libexif
$SCRIPTS/build libxml2
$SCRIPTS/build libgcrypt
$SCRIPTS/build libnfo
$SCRIPTS/build curl

if [ "$DEBUG" = yes ]; then
  DEBUG_CONFIG="--enable-debug"
else
  DEBUG_CONFIG="--disable-debug"
fi

cd $BUILD/$1*
LDFLAGS="$LDFLAGS -lrt" \
./configure --prefix=$LIB_PREFIX \
            --enable-static \
            --disable-shared \
            --cross-compile \
            --disable-optimize \
            --disable-doc \
            --disable-logcolor \
            --disable-grabber-dummy \
            --enable-grabber-allocine \
            --enable-grabber-amazon \
            --enable-grabber-exif \
            --enable-grabber-ffmpeg \
            --enable-grabber-imdb \
            --enable-grabber-lastfm \
            --enable-grabber-local \
            --disable-grabber-lyricsfly \
            --enable-grabber-lyricwiki \
            --enable-grabber-nfo \
            --enable-grabber-tvdb \
            --enable-grabber-tmdb \
            --enable-grabber-tvrage \
            $DEBUG_CONFIG \

make -C src
[ "$DEVTOOLS" = yes ] && make test
make -C src install
cp -f libvalhalla.pc $LIB_PREFIX/lib/pkgconfig/
