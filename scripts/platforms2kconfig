#!/bin/sh

cat > config/Kconfig.platform <<EOF
############################################
# This file is autogenerated, do not edit! #
############################################

choice
  prompt "Target platform"
EOF

for i in config/platforms/*; do
  arch=`basename $i`
  ARCHS="$ARCHS $arch"
  echo "  default TARGET_PLATFORM_${arch}_generic if TARGET_ARCH_${arch}" >> config/Kconfig.platform
done

cat >> config/Kconfig.platform <<EOF
  help
    Target platform
EOF

for arch in $ARCHS; do
  cat config/platforms/$arch/*/Kconfig >> config/Kconfig.platform
done

cat >> config/Kconfig.platform <<EOF
endchoice

config GX_TARGET_PLATFORM
  string
EOF

for arch in $ARCHS; do
  for i in config/platforms/$arch/*; do
    platform=`basename $i`
    echo "  default \"${platform}\" if TARGET_PLATFORM_${arch}_${platform}" >> config/Kconfig.platform
  done
done
